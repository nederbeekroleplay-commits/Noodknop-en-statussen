<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8" />
<title>Noodknop & Status Systeem</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<style>
    body { 
        font-family: Arial; 
        background:#0d0d0d; 
        color:white; 
        margin:0;
        padding:0;
    }
    button {
        padding:12px;
        margin:5px;
        border:none;
        border-radius:8px;
        font-size:16px;
        cursor:pointer;
    }
    .statusBtn { width: 160px; }
    .card {
        background:#1d1d1d;
        padding:15px;
        border-radius:10px;
        margin:10px 0;
    }
</style>

<!-- GELUID VOOR NOODKNOP -->
<audio id="alertSound">
    <source src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg" type="audio/ogg">
</audio>

<!-- FIREBASE -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
import { getDatabase, ref, set, onValue, remove } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";
import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";

const firebaseConfig = {
    apiKey: "AIzaSyBa_2hGKhEH_dU6xDIfIjIO8_BlubM-JSc",
    authDomain: "politie-nederbeek-fd6ff.firebaseapp.com",
    databaseURL: "https://politie-nederbeek-fd6ff-default-rtdb.europe-west1.firebasedatabase.app/",
    projectId: "politie-nederbeek-fd6ff",
    storageBucket: "politie-nederbeek-fd6ff.firebasestorage.app",
    messagingSenderId: "49112852872",
    appId: "1:49112852872:web:9b235d5e5dfd2c89aaf23d",
    measurementId: "G-5TVFPYEZMS"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase();
const auth = getAuth();

let currentUser = null;
let currentRoepnummer = null;
// ------------ LOGIN FUNCTIE -------------
window.login = function() {
    const name = document.getElementById("username").value;
    const roep = document.getElementById("roepnummer").value;

    if (!name || !roep) {
        alert("Vul je naam en roepnummer in!");
        return;
    }

    signInAnonymously(auth).then(() => {
        currentUser = name;
        currentRoepnummer = roep;

        set(ref(db, "users/" + roep), {
            username: name,
            roepnummer: roep,
            status: 1,
            dienst: "indienst",
            timestamp: Date.now()
        });

        document.getElementById("loginScreen").style.display = "none";
        document.getElementById("main").style.display = "block";
    });
};

// ------------- STATUS WIJZIGEN --------------
window.setStatus = function(status) {
    if (!currentRoepnummer) return;

    set(ref(db, "users/" + currentRoepnummer + "/status"), status);
    set(ref(db, "users/" + currentRoepnummer + "/timestamp"), Date.now());
};

// ------------- DIENST --------------
window.goUitDienst = function() {
    if (!currentRoepnummer) return;

    remove(ref(db, "users/" + currentRoepnummer));
    alert("Je bent uit dienst gezet.");

    document.getElementById("main").style.display = "none";
    document.getElementById("loginScreen").style.display = "block";
};

window.goInDienst = function() {
    if (!currentRoepnummer) return;

    set(ref(db, "users/" + currentRoepnummer + "/dienst"), "indienst");
};

// ------------- NOODKNOP --------------
window.activateEmergency = function() {
    set(ref(db, "emergencyAlert"), {
        active: true,
        username: currentUser,
        roepnummer: currentRoepnummer,
        timestamp: Date.now()
    });

    document.getElementById("alertSound").play();
};

// ------------- RESET NOODKNOP --------------
window.resetEmergency = function() {
    set(ref(db, "emergencyAlert"), { active: false });
};

// ------------- EINDE DIENST RESET --------------
window.resetDienst = function() {
    remove(ref(db, "users"));
    set(ref(db, "emergencyAlert"), { active: false });
    alert("De hele dienst is gereset.");
};

// ------------ STATUS KLEUREN --------------
window.statusColor = function(s) {
    switch(s) {
        case 1: return "#4caf50";
        case 2: return "#1e88e5";
        case 3: return "#1565c0";
        case 4: return "#ff9800";
        case 5: return "#f44336";
        case 6: return "#b71c1c";
        case 7: return "#880e4f";
        case 8: return "#424242";
        default: return "gray";
    }
};
// ------------ REALTIME GEBRUIKERS OVERZICHT --------------
const usersRef = ref(db, "users");
onValue(usersRef, (snapshot) => {
    const data = snapshot.val() || {};
    const overview = document.getElementById("overviewList");

    overview.innerHTML = "";

    Object.values(data)
        .sort((a, b) => a.status - b.status) // sorteren op status
        .forEach(u => {
            const box = document.createElement("div");
            box.style.background = statusColor(u.status);
            box.style.padding = "12px";
            box.style.borderRadius = "10px";
            box.style.margin = "5px 0";
            box.style.color = "white";
            box.style.fontSize = "18px";

            box.innerHTML = `
                <strong>${u.username}</strong> 
                (${u.roepnummer})  
                â€” Status ${u.status}
            `;

            overview.appendChild(box);
        });
});

// ------------ NOODKNOP ALERT LUISTEREN --------------
const alertRef = ref(db, "emergencyAlert");
onValue(alertRef, (snapshot) => {
    const data = snapshot.val();
    const alertBox = document.getElementById("emergencyAlertBox");

    if (data && data.active) {
        alertBox.style.display = "flex";
        alertBox.innerHTML = `
            <div style="text-align:center;">
                <h1 style="font-size:50px;color:white;">ğŸš¨ NOODKNOP INGEDRUKT ğŸš¨</h1>
                <h2 style="color:white;font-size:35px;">
                    ${data.username} (${data.roepnummer})
                </h2>
                <button onclick="resetEmergency()" 
                    style="padding:20px;font-size:25px;background:white;color:red;border-radius:12px;">
                    Reset
                </button>
            </div>
        `;
    } else {
        alertBox.style.display = "none";
    }
});
</script>
<body style="font-family: Arial; background:#f2f2f2; margin:0; padding:0;">

<!-- ================= LOGIN PAGINA ================= -->
<div id="loginPage" style="padding:30px; max-width:400px; margin:auto;">
    <h2>Inloggen</h2>

    <label>Gebruikersnaam</label>
    <input id="loginUsername" type="text" style="width:100%; padding:10px; margin-bottom:10px;">

    <label>Roepnummer</label>
    <input id="loginRoepnummer" type="text" style="width:100%; padding:10px; margin-bottom:20px;">

    <button onclick="login()"
        style="width:100%; padding:15px; background:black; color:white; font-size:18px; border:none;">
        Login
    </button>
</div>

<!-- ================= DASHBOARD ================= -->
<div id="dashboard" style="display:none; padding:20px;">

    <h2 id="welcomeTitle">Welkom</h2>

    <!-- INDIEST / UITDIENST -->
    <div style="margin-bottom:20px;">
        <button onclick="setStatus(1)" style="padding:12px;">ğŸš“ Indienst</button>
        <button onclick="setStatus(8)" style="padding:12px; background:red; color:white;">âŒ Uitdienst</button>
    </div>

    <!-- STATUS KNOPPEN -->
    <div>
        <h3>Status instellen:</h3>
        <button onclick="setStatus(1)">1 â€“ Inzetbaar</button>
        <button onclick="setStatus(2)">2 â€“ Aanrijdend</button>
        <button onclick="setStatus(3)">3 â€“ Ter plaatse</button>
        <button onclick="setStatus(4)">4 â€“ Bezet</button>
        <button onclick="setStatus(5)">5 â€“ Transport</button>
        <button onclick="setStatus(6)">6 â€“ Aanvraag OC</button>
        <button onclick="setStatus(7)">7 â€“ Spoed OC</button>
    </div>

    <br><br>

    <!-- NOODKNOP -->
    <button onclick="pressEmergency()"
        style="width:100%; padding:20px; background:red; color:white; font-size:25px; border:none; border-radius:10px;">
        ğŸš¨ NOODKNOP
    </button>

    <!-- GELUID -->
    <audio id="alertSound">
        <source src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg">
    </audio>

    <!-- RESET KNOP -->
    <div style="margin-top:40px;">
        <button onclick="resetAll()" 
            style="padding:15px; background:#333; color:white; width:100%; border:none;">
            ğŸ”„ Reset dienst
        </button>
    </div>

    <br><br>

    <!-- OVD OVERZICHT -->
    <h2>ğŸ“‹ OVD Overzicht</h2>
    <div id="overviewList" style="background:white; padding:15px; border-radius:10px;"></div>

</div>

<!-- ================= NOOD ALERT ================= -->
<div id="emergencyAlertBox"
     style="display:none; 
            position:fixed; 
            top:0; left:0; 
            width:100%; height:100%; 
            background:red; 
            justify-content:center; 
            align-items:center;
            z-index:9999;
            text-align:center;">
</div>

</body>
// ================= STATUS KLEUREN =================
function statusColor(num) {
    switch (num) {
        case 1: return "#28a745";       // groen â€“ inzetbaar
        case 2: return "#007bff";       // blauw â€“ aanrijdend
        case 3: return "#17a2b8";       // cyaan â€“ ter plaatse
        case 4: return "#ffc107";       // geel â€“ bezet
        case 5: return "#6f42c1";       // paars â€“ transport
        case 6: return "#fd7e14";       // oranje â€“ aanvraag OC
        case 7: return "#dc3545";       // rood â€“ spoed OC
        case 8: return "#343a40";       // donkergrijs â€“ uitdienst
        default: return "#666";
    }
}

// ================= CSS GLOBAL STYLING =================
document.head.insertAdjacentHTML("beforeend", `
<style>

    body {
        font-family: Arial, sans-serif;
        background: #f4f4f4;
    }

    button {
        padding: 12px 18px;
        margin: 4px;
        border: none;
        background: #222;
        color: white;
        border-radius: 8px;
        cursor: pointer;
    }

    button:hover {
        filter: brightness(1.2);
    }

    #overviewList div {
        margin-bottom: 10px;
        border-radius: 10px;
        padding: 12px;
        font-size: 18px;
        font-weight: bold;
        color: white;
    }

</style>
`);
