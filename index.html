<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Nederbeek â€” Meldkamer</title>

<style>
:root{
--bg:#001b35;
--card:#07243d;
--muted:#a9c2d6;
--accent:#ffc600;
--white:#ffffff;
--danger:#d32f2f;
}
*{box-sizing:border-box}
body{margin:0;font-family:Inter,Arial;background:var(--bg);color:var(--white)}
.container{max-width:1200px;margin:auto;padding:18px}
.card{background:var(--card);padding:14px;border-radius:12px;margin-bottom:12px}
.btn{background:var(--accent);color:#001b35;border:none;padding:8px 12px;border-radius:8px;font-weight:700;cursor:pointer}
.btn.ghost{background:transparent;border:1px solid rgba(255,255,255,.1);color:var(--white)}
.btn.danger{background:var(--danger);color:white}
input,select,textarea{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,.1);background:transparent;color:white}
.small{font-size:13px;color:var(--muted)}
.row{display:flex;justify-content:space-between;align-items:center;padding:10px;border-radius:8px;margin-bottom:6px;background:#031726}
.status{padding:6px 10px;border-radius:8px;font-weight:700}
.hidden{display:none}
</style>
</head>

<body>
<div class="container">

<h2>Nederbeek â€” Meldkamer</h2>

<!-- LOGIN -->
<div id="loginCard" class="card">
<h3>Inloggen</h3>
<input id="inputName" placeholder="Naam">
<input id="inputRoep" placeholder="Roepnummer">
<button id="btnLogin" class="btn">Inloggen</button>
<div class="small">Roepsnummer moet uniek zijn</div>
</div>

<!-- CONTROL -->
<div id="controlCard" class="card hidden">
<div id="currentUser"></div>

<select id="statusSelect">
<option value="1">1 â€” Inzetbaar</option>
<option value="2">2 â€” Aanrijdend</option>
<option value="3">3 â€” Ter plaatse</option>
<option value="4">4 â€” Bezet</option>
<option value="8">8 â€” Uit dienst</option>
</select>

<button id="btnNood" class="btn danger">ðŸš¨ NOOD</button>
<button id="btnLogout" class="btn ghost">Uitloggen</button>

<!-- ADMIN -->
<div id="adminPanel" class="card hidden">
<h3>ADMIN</h3>
<button id="btnResetDienst" class="btn ghost">Reset alle gebruikers</button>
<button id="btnViewLogs" class="btn ghost">Toon logs</button>
</div>
</div>

<!-- LIVE OVERZICHT -->
<div class="card">
<h3>Live gebruikers</h3>
<div id="ovdList"></div>
</div>

<!-- LOGS -->
<div id="logPanel" class="card hidden">
<h3>Audit log</h3>
<div id="logList"></div>
</div>

</div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>

<script>
/* ================= CONFIG ================= */
const firebaseConfig = {
apiKey: "AIzaSyBa_2hGKhEH_dU6xDIfIjIO8_BlubM-JSc",
authDomain: "politie-nederbeek-fd6ff.firebaseapp.com",
databaseURL: "https://politie-nederbeek-fd6ff-default-rtdb.europe-west1.firebasedatabase.app/",
projectId: "politie-nederbeek-fd6ff"
};
firebase.initializeApp(firebaseConfig);

const db = firebase.database();
const auth = firebase.auth();

/* ================= ADMIN ================= */
const ADMIN_ROEP = "0001";

/* ================= STATE ================= */
let currentUser = null;

/* ================= LOGIN ================= */
btnLogin.onclick = async () => {
const naam = inputName.value.trim();
const roep = inputRoep.value.trim();
if(!naam || !roep) return alert("Alles invullen");

const snap = await db.ref("gebruikers/"+roep).once("value");
if(snap.exists()) return alert("Dit roepnummer is al ingelogd");

await auth.signInAnonymously();

currentUser = {naam, roep};
await db.ref("gebruikers/"+roep).set({
naam, roep, status:1, tijd:Date.now()
});

await log("login");

loginCard.classList.add("hidden");
controlCard.classList.remove("hidden");
currentUserDiv();

if(roep === ADMIN_ROEP){
adminPanel.classList.remove("hidden");
}
};

/* ================= LOGOUT ================= */
btnLogout.onclick = async () => {
if(!currentUser) return;
await log("logout");
await db.ref("gebruikers/"+currentUser.roep).remove();
currentUser=null;
location.reload();
};

/* ================= STATUS ================= */
statusSelect.onchange = async ()=>{
if(!currentUser) return;
const s = Number(statusSelect.value);
if(s===8){
await log("uitdienst");
await db.ref("gebruikers/"+currentUser.roep).remove();
location.reload();
return;
}
await db.ref("gebruikers/"+currentUser.roep+"/status").set(s);
await log("status "+s);
};

/* ================= NOOD ================= */
btnNood.onclick = async ()=>{
await db.ref("nood").set({
actief:true,
door:currentUser.roep,
tijd:Date.now()
});
await log("NOOD");
};

/* ================= ADMIN ================= */
btnResetDienst.onclick = async ()=>{
if(!confirm("Alles resetten?")) return;
await db.ref("gebruikers").remove();
await log("ADMIN RESET");
};

btnViewLogs.onclick = ()=>{
logPanel.classList.toggle("hidden");
};

/* ================= LOGGING ================= */
function log(actie){
return db.ref("logs").push({
actie,
door: currentUser ? currentUser.roep : "SYSTEM",
tijd: Date.now()
});
}

/* ================= RENDER ================= */
db.ref("gebruikers").on("value",snap=>{
ovdList.innerHTML="";
const data = snap.val()||{};
Object.values(data).forEach(u=>{
const d=document.createElement("div");
d.className="row";
d.innerHTML=`<div>${u.naam} (${u.roep})</div><div class="status">${u.status}</div>`;
ovdList.appendChild(d);
});
});

db.ref("logs").limitToLast(50).on("value",snap=>{
logList.innerHTML="";
const data = snap.val()||{};
Object.values(data).reverse().forEach(l=>{
const d=document.createElement("div");
d.className="small";
d.textContent=`${new Date(l.tijd).toLocaleString()} â€” ${l.door} â€” ${l.actie}`;
logList.appendChild(d);
});
});

function currentUserDiv(){
document.getElementById("currentUser").innerHTML =
`Ingelogd als <b>${currentUser.naam}</b> (${currentUser.roep})`;
}
</script>
</body>
</html>
