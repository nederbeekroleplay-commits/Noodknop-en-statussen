<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Nederbeek ‚Äî Meldkamer</title>

<style>
:root{
 --bg:#001b35;--card:#07243d;--muted:#a9c2d6;--accent:#ffc600;--white:#fff
}
*{box-sizing:border-box}
body{
 margin:0;
 font-family:Arial;
 background:var(--bg);
 color:var(--white);
 overflow-x:hidden
}
body::before{
 content:'';
 position:fixed;
 inset:0;
 pointer-events:none;
 background:url('https://i.imgur.com/6QJjYMe.png') repeat;
 opacity:.07;
 z-index:0
}
.container{
 max-width:1200px;
 margin:20px auto;
 padding:20px;
 position:relative;
 z-index:1
}
.card{
 background:var(--card);
 padding:16px;
 border-radius:12px;
 margin-bottom:12px
}
.btn{
 background:var(--accent);
 color:#001b35;
 border:none;
 padding:10px 14px;
 border-radius:8px;
 font-weight:bold;
 cursor:pointer
}
.btn.ghost{
 background:transparent;
 color:#fff;
 border:1px solid rgba(255,255,255,.2)
}
input,select,textarea{
 width:100%;
 padding:10px;
 border-radius:8px;
 border:none;
 margin-top:8px
}
.row{
 display:flex;
 justify-content:space-between;
 align-items:center;
 padding:10px;
 background:#031726;
 border-radius:8px;
 margin-bottom:6px
}
.small{color:var(--muted);font-size:13px}
.huge{padding:18px;font-size:20px;border-radius:12px}
.nood{
 background:linear-gradient(180deg,#ff4d4f,#b00000);
 color:white
}
</style>
</head>

<body>

<div class="container">

<h2>Nederbeek ‚Äî Meldkamer</h2>

<div id="loginCard" class="card">
 <h3>Inloggen</h3>
 <input id="inputName" placeholder="Naam">
 <input id="inputRoep" placeholder="Roepnummer">
 <button id="btnLogin" class="btn" style="margin-top:10px">Aanmelden</button>
</div>

<div id="controlCard" class="card" style="display:none">
 <div id="currentUser" class="small"></div>

 <select id="statusSelect">
  <option value="1">1 ‚Äî Vrij</option>
  <option value="2">2 ‚Äî Aanrijdend</option>
  <option value="3">3 ‚Äî Ter plaatse</option>
  <option value="4">4 ‚Äî Bezet</option>
  <option value="8">8 ‚Äî Uit dienst</option>
 </select>

 <button id="btnNood" class="btn huge nood" style="margin-top:10px">
  üö® NOODKNOP
 </button>

 <button id="btnLogout" class="btn ghost" style="margin-top:10px">
  Uitloggen
 </button>
</div>

<div class="card">
 <h3>Live overzicht</h3>
 <div id="ovdList"></div>
</div>

<div id="adminPanel" class="card" style="display:none">
 <h3>Admin panel</h3>

 <h4>Login-aanvragen</h4>
 <div id="loginRequests"></div>

 <h4>Actieve gebruikers</h4>
 <div id="adminUserList"></div>

 <h4>Geblokkeerd</h4>
 <div id="blockedList"></div>
</div>

</div>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>

<script>
firebase.initializeApp({
 apiKey:"AIzaSyBa_2hGKhEH_dU6xDIfIjIO8_BlubM-JSc",
 authDomain:"politie-nederbeek-fd6ff.firebaseapp.com",
 databaseURL:"https://politie-nederbeek-fd6ff-default-rtdb.europe-west1.firebasedatabase.app/"
});

const db = firebase.database();
const auth = firebase.auth();
const ADMIN_ROEP = "34-001";
let current = null;

const statusTxt = {
 1:"Vrij",
 2:"Aanrijdend",
 3:"Ter plaatse",
 4:"Bezet"
};

/* LOGIN */
btnLogin.onclick = async () => {
 const naam = inputName.value.trim();
 const roep = inputRoep.value.trim();
 if (!naam || !roep) return alert("Vul alles in");

 if ((await db.ref("blockedUsers/" + roep).once("value")).exists())
  return alert("‚õî Geblokkeerd");

 // üëÆ ADMIN MAG ALTIJD ERIN
 if (roep !== ADMIN_ROEP) {
  const approved = await db.ref("approvedUsers/" + roep).once("value");
  if (!approved.exists()) {
   await db.ref("loginRequests/" + roep).set({
    naam, roep, tijd: Date.now()
   });
   return alert("‚è≥ Wachten op goedkeuring door admin");
  }
 }

 await auth.signInAnonymously();
 current = { naam, roep, isAdmin: roep === ADMIN_ROEP };

 await db.ref("gebruikers/" + roep).set({
  naam, roep, status: 1
 });

 loginCard.style.display = "none";
 controlCard.style.display = "block";
 currentUser.innerHTML = `Ingelogd als <b>${naam}</b> (${roep})`;

 if (current.isAdmin) adminPanel.style.display = "block";
};

/* LOGOUT */
btnLogout.onclick = async () => {
 await db.ref("gebruikers/" + current.roep).remove();
 location.reload();
};

/* STATUS */
statusSelect.onchange = () => {
 if (statusSelect.value == 8) btnLogout.onclick();
 else db.ref("gebruikers/" + current.roep + "/status").set(+statusSelect.value);
};

/* OVERZICHT */
db.ref("gebruikers").on("value", s => {
 ovdList.innerHTML = "";
 adminUserList.innerHTML = "";
 Object.entries(s.val() || {}).forEach(([roep,u])=>{
  ovdList.innerHTML += `
   <div class="row">
    <div>${u.naam} (${roep})</div>
    <div class="small">${statusTxt[u.status]}</div>
   </div>`;
  if (current?.isAdmin){
   adminUserList.innerHTML += `
    <div class="row">
     <div>${u.naam} (${roep})</div>
     <button class="btn ghost" onclick="blockUser('${roep}')">Blokkeer</button>
    </div>`;
  }
 });
});

/* LOGIN REQUESTS (ADMIN) */
db.ref("loginRequests").on("value", s => {
 loginRequests.innerHTML = "";
 Object.entries(s.val() || {}).forEach(([roep,u])=>{
  loginRequests.innerHTML += `
   <div class="row">
    <div>${u.naam} (${roep})</div>
    <button class="btn" onclick="approveUser('${roep}')">Toestaan</button>
   </div>`;
 });
});

function approveUser(roep){
 db.ref("approvedUsers/"+roep).set(true);
 db.ref("loginRequests/"+roep).remove();
}

/* BLOCKED USERS */
function blockUser(roep){
 db.ref("blockedUsers/"+roep).set(true);
 db.ref("gebruikers/"+roep).remove();
}

db.ref("blockedUsers").on("value", s=>{
 blockedList.innerHTML="";
 Object.keys(s.val()||{}).forEach(roep=>{
  blockedList.innerHTML+=`
   <div class="row">
    <div>${roep}</div>
    <button class="btn ghost" onclick="db.ref('blockedUsers/${roep}').remove()">Deblokkeer</button>
   </div>`;
 });
});
</script>

</body>
</html>
