<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Nederbeek ‚Äî Meldkamer Kerst</title>

<style>
:root{
 --bg:#001b35;
 --card:#07243d;
 --muted:#a9c2d6;
 --accent:#ffc600;
 --white:#fff;
 --highlight:#ff4d4f;
}
*{box-sizing:border-box}
body{margin:0;font-family:Arial;background:var(--bg);color:var(--white);overflow-x:hidden}

/* Kerstlichtjes banner bovenaan */
#banner {
  position:fixed;
  top:0;left:0;
  width:100%;height:60px;
  background:url('https://cdn.pixabay.com/photo/2016/12/19/13/20/christmas-tree-1912433_960_720.jpg') center/cover;
  opacity:0.7;
  z-index:2;
}

/* Sneeuw overlay */
#snowOverlay {
  pointer-events:none;
  position:fixed;
  top:0;left:0;
  width:100%;height:100%;
  background:url('https://www.pngkit.com/png/detail/38-380659_overlay-png-image-snow.png') repeat; /* sneeuw PNG overlay */ :contentReference[oaicite:1]{index=1}
  opacity:0.5;
  z-index:1;
}

.container{
 max-width:1200px;
 margin:80px auto 20px; /* banner ruimte */
 padding:20px;
 position:relative;
 z-index:2;
}
.card{
 background:var(--card);
 padding:16px;
 border-radius:12px;
 margin-bottom:12px;
 position:relative;
 overflow:hidden;
}
.card::before{
 content:'';
 position:absolute;
 top:8px;
 right:8px;
 width:28px;height:28px;
 background:url('https://cdn.pixabay.com/photo/2013/07/13/10/07/christmas-158132_1280.png') no-repeat center/contain;
}
#logo{
 display:block;
 margin:0 auto 12px;
 width:100px;
}
.btn{background:var(--accent);color:#001b35;border:none;padding:10px 14px;border-radius:8px;font-weight:bold;cursor:pointer}
.btn.ghost{background:transparent;color:#fff;border:1px solid rgba(255,255,255,.2)}
input,select,textarea{width:100%;padding:10px;border-radius:8px;border:none;margin-top:8px}
.row{display:flex;justify-content:space-between;align-items:center;padding:10px;background:#031726;border-radius:8px;margin-bottom:6px}
.small{color:var(--muted);font-size:13px}
.huge{padding:18px;font-size:20px;border-radius:12px}
.nood{background:linear-gradient(180deg,var(--highlight),#b00000);color:white}
table{width:100%;border-collapse:collapse}
th,td{padding:8px;border-bottom:1px solid rgba(255,255,255,.1)}
.vta-table th{background:#031726}
#alertOverlay{
 position:fixed;inset:0;display:none;
 background:rgba(120,0,0,.95);
 align-items:center;justify-content:center;
 text-align:center;z-index:9999;
 animation:pulse .8s infinite
}
@keyframes pulse{0%{opacity:1}50%{opacity:.3}100%{opacity:1}}
</style>
</head>
<body>

<div id="banner"></div> 
<div id="snowOverlay"></div> <!-- sneeuw overlay -->

<img id="logo" src="https://cdn.pixabay.com/photo/2013/07/13/10/07/christmas-158131_1280.png" alt="Kerstlogo"> <!-- kerstboom PNG -->

<div class="container">

<h2>Nederbeek ‚Äî Meldkamer üéÑ</h2>

<div id="loginCard" class="card">
 <h3>Inloggen</h3>
 <input id="inputName" placeholder="Naam">
 <input id="inputRoep" placeholder="Roepnummer">
 <button id="btnLogin" class="btn" style="margin-top:10px">Inloggen</button>
</div>

<div id="controlCard" class="card" style="display:none">
 <div id="currentUser" class="small"></div>

 <select id="statusSelect">
  <option value="1">1 ‚Äî Vrij</option>
  <option value="2">2 ‚Äî Aanrijdend</option>
  <option value="3">3 ‚Äî Ter plaatse</option>
  <option value="4">4 ‚Äî Bezet</option>
  <option value="8">8 ‚Äî Uit dienst</option>
 </select>

 <button id="btnAdminMode" class="btn ghost" style="display:none;margin-top:8px">
  üîê Admin‚Äëmodus
 </button>

 <button id="btnNood" class="btn huge nood" style="margin-top:10px">
  üö® NOODKNOP
 </button>

 <button id="btnResetDienst" class="btn ghost" style="margin-top:8px">
  üîÑ Reset dienst
 </button>

 <button id="btnLogout" class="btn ghost" style="margin-top:10px">
  Uitloggen
 </button>
</div>

<div class="card">
 <h3>Live overzicht</h3>
 <div id="ovdList"></div>
</div>

<div id="adminPanel" class="card" style="display:none">
 <h3>üîê Admin panel ‚Äî Gebruikers</h3>
 <div id="adminUserList"></div>
 <h4>‚õî Geblokkeerde gebruikers</h4>
 <div id="blockedList"></div>
</div>

<div class="card">
 <h3>VTA toevoegen</h3>
 <input id="vtaNaam" placeholder="Naam">
 <input id="vtaKenteken" placeholder="Kenteken">
 <textarea id="vtaInfo" placeholder="Signalement"></textarea>
 <input type="file" id="vtaFoto">
 <button id="btnAddVta" class="btn" style="margin-top:8px">Opslaan VTA</button>
</div>

<div class="card">
 <h3>VTAs</h3>
 <input id="vtaSearch" placeholder="Zoeken...">
 <table class="vta-table">
  <thead>
   <tr>
    <th>Foto</th>
    <th>Naam</th>
    <th>Kenteken</th>
    <th>Signalement</th>
    <th>Actie</th>
   </tr>
  </thead>
  <tbody id="vtaTable"></tbody>
 </table>
</div>

</div>

<div id="alertOverlay">
 <div>
  <h1>üö® NOODALARM üö®</h1>
  <p id="alertDetail"></p>
  <button class="btn" id="closeAlert">Stop alarm</button>
 </div>
</div>

<audio id="alarmAudio" loop>
 <source src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg">
</audio>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>

<script>
// ‚Äî‚Äî‚Äî Firebase Init ‚Äî‚Äî‚Äî
firebase.initializeApp({
 apiKey:"AIzaSyBa_2hGKhEH_dU6xDIfIjIO8_BlubM-JSc",
 authDomain:"politie-nederbeek-fd6ff.firebaseapp.com",
 databaseURL:"https://politie-nederbeek-fd6ff-default-rtdb.europe-west1.firebasedatabase.app/"
});

const db=firebase.database(),auth=firebase.auth(),storage=firebase.storage();
const ADMIN_ROEP="34-001";
let current=null,adminMode=false;

const STATUS_MAP={
 1:{t:"Vrij",c:"#2ecc71"},
 2:{t:"Aanrijdend",c:"#f1c40f"},
 3:{t:"Ter plaatse",c:"#3498db"},
 4:{t:"Bezet",c:"#e67e22"},
 8:{t:"Uit dienst",c:"#7f8c8d"}
};

// ‚Äî‚Äî‚Äî LOGIN ‚Äî‚Äî‚Äî
btnLogin.onclick=async()=>{
 const naam=inputName.value.trim(), roep=inputRoep.value.trim();
 if(!naam||!roep) return alert("Vul alles in");

 if((await db.ref("blockedUsers/"+roep).once("value")).exists())
  return alert("‚ùå Geblokkeerd");

 if((await db.ref("gebruikers/"+roep).once("value")).exists())
  return alert("Roepnummer al actief");

 await auth.signInAnonymously();
 const isAdmin = roep===ADMIN_ROEP;
 current = {naam,roep,isAdmin};

 await db.ref("gebruikers/"+roep).set({
  naam, roep:isAdmin?"ADMIN":roep, realRoep:roep, status:1, tijd:Date.now()
 });

 loginCard.style.display="none";
 controlCard.style.display="block";
 currentUser.innerHTML = `Ingelogd als <b>${naam}</b> (${isAdmin?"ADMIN":roep})`;
 if(isAdmin) btnAdminMode.style.display="block";
};

// ‚Äî‚Äî‚Äî Logout + Status ‚Äî‚Äî‚Äî
btnLogout.onclick=async()=>{
 await db.ref("gebruikers/"+current.roep).remove();
 location.reload();
};
statusSelect.onchange=async()=>{
 if(statusSelect.value==8){
  await db.ref("gebruikers/"+current.roep).remove();
  location.reload();
 } else await db.ref("gebruikers/"+current.roep+"/status").set(+statusSelect.value);
};

// ‚Äî‚Äî‚Äî Admin blokkeer ‚Äî‚Äî‚Äî
btnAdminMode.onclick=()=>{ adminMode=true; adminPanel.style.display="block"; alert("Admin actief"); };
function blockUser(r,n){ const reden=prompt("Reden blokkering?"); if(!reden)return; db.ref("blockedUsers/"+r).set({naam:n,reden,tijd:Date.now()}); db.ref("gebruikers/"+r).remove(); }
function unblockUser(r){ if(!confirm("Deblokkeer?"))return; db.ref("blockedUsers/"+r).remove(); }

// ‚Äî‚Äî‚Äî Listeners ‚Äî‚Äî‚Äî
db.ref("gebruikers").on("value",s=>{
 ovdList.innerHTML=""; adminUserList.innerHTML="";
 Object.values(s.val()||{}).forEach(u=>{
  const st=STATUS_MAP[u.status]||{t:"Onbekend",c:"#ccc"};
  const div=document.createElement("div"); div.className="row";
  div.innerHTML=`
   <div><b>${u.naam}</b><br><span class="small">${adminMode?(u.realRoep||u.roep):u.roep}</span></div>
   <div style="background:${st.c};padding:6px 10px;border-radius:8px;color:#001b35">${u.status} ‚Äî ${st.t}</div>`;
  ovdList.appendChild(div);

  if(adminMode){
   const row2=document.createElement("div"); row2.className="row";
   row2.innerHTML=`<div>${u.naam} (${u.realRoep})</div><button class="btn ghost" onclick="blockUser('${u.realRoep}','${u.naam}')">‚õî Blokkeer</button>`;
   adminUserList.appendChild(row2);
  }
 });
});

db.ref("blockedUsers").on("value",s=>{
 blockedList.innerHTML="";
 Object.entries(s.val()||{}).forEach(([r,u])=>{
  const div=document.createElement("div"); div.className="row";
  div.innerHTML=`<div>${u.naam} (${r})<br><span class="small">${u.reden}</span></div> <button class="btn ghost" onclick="unblockUser('${r}')">‚úÖ Deblokkeer</button>`;
  blockedList.appendChild(div);
 });
});

// ‚Äî‚Äî‚Äî Nood ‚Äî‚Äî‚Äî
btnNood.onclick=async()=>{await db.ref("nood").set({actief:true,door:current.roep,tijd:Date.now()});};
closeAlert.onclick=async()=>{await db.ref("nood").set({actief:false});};
db.ref("nood").on("value",s=>{const d=s.val(); if(d&&d.actief){alertOverlay.style.display="flex";alertDetail.innerText="Door: "+d.door;alarmAudio.play().catch(()=>{});} else {alertOverlay.style.display="none";alarmAudio.pause();alarmAudio.currentTime=0;}});

// ‚Äî‚Äî‚Äî VTA ‚Äî‚Äî‚Äî
btnAddVta.onclick=async()=>{
 const ref=db.ref("vtas").push();
 const rec={id:ref.key,naam:vtaNaam.value||"ONBEKEND",kenteken:vtaKenteken.value||"ONBEKEND",info:vtaInfo.value||"",tijd:Date.now()};
 if(vtaFoto.files[0]){
  const up=storage.ref("vtas/"+rec.id).put(vtaFoto.files[0]);
  up.on("state_changed",null,null,async()=>{rec.foto=await up.snapshot.ref.getDownloadURL();await ref.set(rec);});
 } else await ref.set(rec);
};
db.ref("vtas").on("value",s=>{vtaTable.innerHTML="";Object.values(s.val()||{}).forEach(v=>{if(vtaSearch.value && !JSON.stringify(v).toLowerCase().includes(vtaSearch.value.toLowerCase()))return; const tr=document.createElement("tr"); tr.innerHTML=`<td>${v.foto?`<img src="${v.foto}">`:`<span class="small">Geen</span>`}</td><td>${v.naam}</td><td>${v.kenteken}</td><td class="small">${v.info}</td><td><button class="btn ghost" onclick="db.ref('vtas/${v.id}').remove()">Verwijder</button></td>`; vtaTable.appendChild(tr);});});
</script>

</body>
</html>
