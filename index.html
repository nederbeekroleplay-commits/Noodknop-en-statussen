<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<title>Noodknop & Status Systeem</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- FIREBASE ZONDER MODULES (WERKT OP GITHUB PAGES!) -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>

<style>
    body { 
        font-family: Arial; 
        background:#111; 
        color:white; 
        margin:0; 
        padding:20px;
    }
    button {
        padding:12px;
        margin:5px;
        border:none;
        border-radius:8px;
        font-size:16px;
        cursor:pointer;
    }
</style>
</head>

<body>

<!-- =============== LOGIN =============== -->
<div id="loginPage">
    <h2>Inloggen</h2>

    <label>Naam</label><br>
    <input id="username" style="width:100%;padding:10px;"><br><br>

    <label>Roepnummer</label><br>
    <input id="roepnummer" style="width:100%;padding:10px;"><br><br>

    <button onclick="login()" style="width:100%;padding:15px;background:black;color:white;">
        INLOGGEN
    </button>
</div>

<!-- =============== DASHBOARD =============== -->
<div id="dashboard" style="display:none;">
    <h2 id="welcomeTitle"></h2>

    <h3>Status instellen</h3>
    <button onclick="setStatus(1)">1 â€“ Inzetbaar</button>
    <button onclick="setStatus(2)">2 â€“ Aanrijdend</button>
    <button onclick="setStatus(3)">3 â€“ Ter plaatse</button>
    <button onclick="setStatus(4)">4 â€“ Bezet</button>
    <button onclick="setStatus(5)">5 â€“ Transport</button>
    <button onclick="setStatus(6)">6 â€“ Aanvraag OC</button>
    <button onclick="setStatus(7)">7 â€“ Spoed OC</button>
    <button onclick="setStatus(8)" style="background:red;">8 â€“ Uitdienst</button>

    <br><br>

    <button onclick="activateEmergency()" 
        style="width:100%;padding:20px;font-size:30px;background:red;color:white;">
        ðŸš¨ NOODKNOP
    </button>

    <br><br>

    <button onclick="resetDienst()" 
        style="width:100%;padding:15px;background:#444;color:white;">
        ðŸ”„ Reset dienst
    </button>

    <hr>

    <h2>ðŸ“‹ OVD Overzicht</h2>
    <div id="overviewList" style="background:#fff;color:black;padding:15px;border-radius:10px;"></div>
</div>

<!-- =============== NOOD ALERT OVERLAY =============== -->
<div id="emergencyAlertBox"
     style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;
            background:red;color:white;justify-content:center;align-items:center;
            text-align:center;font-size:30px;z-index:9999;">
</div>

<!-- GELUID -->
<audio id="alertSound">
    <source src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg">
</audio>

<script>
// ================= FIREBASE CONFIG =================
const firebaseConfig = {
    apiKey: "AIzaSyBa_2hGKhEH_dU6xDIfIjIO8_BlubM-JSc",
    authDomain: "politie-nederbeek-fd6ff.firebaseapp.com",
    databaseURL: "https://politie-nederbeek-fd6ff-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "politie-nederbeek-fd6ff",
    storageBucket: "politie-nederbeek-fd6ff.firebasestorage.app",
    messagingSenderId: "49112852872",
    appId: "1:49112852872:web:9b235d5e5dfd2c89aaf23d"
};

firebase.initializeApp(firebaseConfig);

const db = firebase.database();
const auth = firebase.auth();

let currentUser = "";
let currentRoepnummer = "";

// ================= LOGIN =================
function login() {
    let name = document.getElementById("username").value;
    let roep = document.getElementById("roepnummer").value;

    if (!name || !roep) return alert("Vul alles in!");

    auth.signInAnonymously().then(() => {
        currentUser = name;
        currentRoepnummer = roep;

        firebase.database().ref("users/" + roep).set({
            username: name,
            roepnummer: roep,
            status: 1,
            dienst: "indienst",
            timestamp: Date.now()
        });

        document.getElementById("loginPage").style.display = "none";
        document.getElementById("dashboard").style.display = "block";
        document.getElementById("welcomeTitle").textContent =
            "Welkom " + name + " (" + roep + ")";
    });
}

// ================= STATUS WIJZIGEN =================
function setStatus(num) {
    firebase.database().ref("users/" + currentRoepnummer + "/status").set(num);
}

// ================= NOODKNOP =================
function activateEmergency() {
    firebase.database().ref("emergencyAlert").set({
        active: true,
        username: currentUser,
        roepnummer: currentRoepnummer,
        timestamp: Date.now()
    });
}

// ================= NOODKNOP RESET =================
function resetEmergency() {
    firebase.database().ref("emergencyAlert").set({ active:false });
}

// ================= DIENST RESET =================
function resetDienst() {
    firebase.database().ref("users").remove();
    firebase.database().ref("emergencyAlert").set({ active:false });
}

// ================= STATUS KLEUR =================
function statusColor(n) {
    switch(n) {
        case 1: return "#4caf50";
        case 2: return "#1e88e5";
        case 3: return "#1565c0";
        case 4: return "#ff9800";
        case 5: return "#9c27b0";
        case 6: return "#ff5722";
        case 7: return "#d32f2f";
        case 8: return "#424242";
        default: return "#555";
    }
}

// ================= REALTIME USERS =================
firebase.database().ref("users").on("value", snap => {
    const data = snap.val() || {};
    const box = document.getElementById("overviewList");
    box.innerHTML = "";

    Object.values(data)
        .sort((a,b) => a.status - b.status)
        .forEach(u => {
            let div = document.createElement("div");
            div.style.background = statusColor(u.status);
            div.style.color = "white";
            div.style.padding = "12px";
            div.style.marginBottom = "10px";
            div.style.borderRadius = "10px";
            div.textContent = `${u.username} (${u.roepnummer}) â€” Status ${u.status}`;
            box.appendChild(div);
        });
});

// ================= NOODKNOP ALERT LISTENER =================
firebase.database().ref("emergencyAlert").on("value", snap => {
    const d = snap.val();
    const box = document.getElementById("emergencyAlertBox");

    if (d && d.active) {
        box.style.display = "flex";
        box.innerHTML = `
            ðŸš¨ NOODKNOP INGEDRUKT ðŸš¨ <br><br>
            ${d.username} (${d.roepnummer}) <br><br>
            <button onclick="resetEmergency()" style="padding:15px;font-size:22px;">
                Reset
            </button>
        `;
        document.getElementById("alertSound").play();
    } else {
        box.style.display = "none";
    }
});
</script>

</body>
</html>

