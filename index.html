<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Nederbeek ‚Äî Meldkamer</title>

<style>
:root{
 --bg:#001b35;--card:#07243d;--muted:#a9c2d6;--accent:#ffc600;--white:#fff
}
*{box-sizing:border-box}
body{
 margin:0;
 font-family:Arial;
 background:var(--bg);
 color:var(--white);
 overflow-x:hidden
}
body::before{
 content:'';
 position:fixed;
 inset:0;
 pointer-events:none;
 background:url('https://i.imgur.com/6QJjYMe.png') repeat;
 opacity:.07;
 z-index:0
}
.container{max-width:1200px;margin:20px auto;padding:20px;position:relative;z-index:1}
.card{background:var(--card);padding:16px;border-radius:12px;margin-bottom:12px}
.btn{background:var(--accent);color:#001b35;border:none;padding:10px 14px;border-radius:8px;font-weight:bold;cursor:pointer}
.btn.ghost{background:transparent;color:#fff;border:1px solid rgba(255,255,255,.2)}
input,select,textarea{width:100%;padding:10px;border-radius:8px;border:none;margin-top:8px}
.row{display:flex;justify-content:space-between;align-items:center;padding:10px;background:#031726;border-radius:8px;margin-bottom:6px}
.small{color:var(--muted);font-size:13px}
.huge{padding:18px;font-size:20px;border-radius:12px}
.nood{background:linear-gradient(180deg,#ff4d4f,#b00000);color:white}

#alertOverlay{
 position:fixed;inset:0;display:none;
 background:rgba(120,0,0,.95);
 align-items:center;justify-content:center;
 text-align:center;z-index:9999;
 animation:pulse .8s infinite
}
@keyframes pulse{0%{opacity:1}50%{opacity:.3}100%{opacity:1}}
</style>
</head>

<body>

<div class="container">
<h2>Nederbeek ‚Äî Meldkamer</h2>

<div id="loginCard" class="card">
 <h3>Inloggen</h3>
 <input id="inputName" placeholder="Naam">
 <input id="inputRoep" placeholder="Roepnummer">
 <button id="btnLogin" class="btn" style="margin-top:10px">Aanmelden</button>
</div>

<div id="controlCard" class="card" style="display:none">
 <div id="currentUser" class="small"></div>

 <select id="statusSelect">
  <option value="1">1 ‚Äî Vrij</option>
  <option value="2">2 ‚Äî Aanrijdend</option>
  <option value="3">3 ‚Äî Ter plaatse</option>
  <option value="4">4 ‚Äî Bezet</option>
  <option value="8">8 ‚Äî Uit dienst</option>
 </select>

 <button id="btnNood" class="btn huge nood" style="margin-top:10px">üö® NOODKNOP</button>
 <button id="btnLogout" class="btn ghost" style="margin-top:10px">Uitloggen</button>
</div>

<div class="card">
 <h3>Live overzicht</h3>
 <div id="ovdList"></div>
</div>

<div class="card">
 <h3>VTA toevoegen</h3>
 <input id="vtaNaam" placeholder="Naam">
 <input id="vtaKenteken" placeholder="Kenteken">
 <textarea id="vtaInfo" placeholder="Signalement"></textarea>
 <button id="btnAddVta" class="btn" style="margin-top:8px">Opslaan VTA</button>
</div>

<div class="card">
 <h3>VTAs</h3>
 <table width="100%">
  <tbody id="vtaTable"></tbody>
 </table>
</div>

<div id="adminPanel" class="card" style="display:none">
 <h3>Admin panel</h3>
 <h4>Login-aanvragen</h4>
 <div id="loginRequests"></div>
 <h4>Actieve gebruikers</h4>
 <div id="adminUserList"></div>
 <h4>Geblokkeerd</h4>
 <div id="blockedList"></div>
</div>
</div>

<div id="alertOverlay">
 <div>
  <h1>üö® NOODALARM üö®</h1>
  <p id="alertDetail"></p>
  <button class="btn" id="closeAlert">Stop alarm</button>
 </div>
</div>

<audio id="alarmAudio" loop>
 <source src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg">
</audio>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>

<script>
firebase.initializeApp({
 apiKey:"AIzaSyBa_2hGKhEH_dU6xDIfIjIO8_BlubM-JSc",
 authDomain:"politie-nederbeek-fd6ff.firebaseapp.com",
 databaseURL:"https://politie-nederbeek-fd6ff-default-rtdb.europe-west1.firebasedatabase.app/"
});

const db=firebase.database();
const auth=firebase.auth();
const ADMIN_ROEP="34-001";
let current=null;

const statusTxt={1:"Vrij",2:"Aanrijdend",3:"Ter plaatse",4:"Bezet"};

/* LOGIN */
btnLogin.onclick=async()=>{
 const naam=inputName.value.trim();
 const roep=inputRoep.value.trim();
 if(!naam||!roep)return alert("Vul alles in");

 if((await db.ref("blockedUsers/"+roep).once("value")).exists())
  return alert("‚õî Geblokkeerd");

 if(roep!==ADMIN_ROEP){
  const ok=await db.ref("approvedUsers/"+roep).once("value");
  if(!ok.exists()){
   await db.ref("loginRequests/"+roep).set({naam,roep,tijd:Date.now()});
   return alert("‚è≥ Wachten op goedkeuring");
  }
 }

 await auth.signInAnonymously();
 current={naam,roep,isAdmin:roep===ADMIN_ROEP};

 await db.ref("gebruikers/"+roep).set({naam,roep,status:1});

 loginCard.style.display="none";
 controlCard.style.display="block";
 currentUser.innerHTML=`Ingelogd als <b>${naam}</b> (${roep})`;
 if(current.isAdmin) adminPanel.style.display="block";
};

/* LOGOUT */
btnLogout.onclick=async()=>{
 await db.ref("gebruikers/"+current.roep).remove();
 location.reload();
};

/* STATUS */
statusSelect.onchange=()=>{
 if(statusSelect.value==8) btnLogout.onclick();
 else db.ref("gebruikers/"+current.roep+"/status").set(+statusSelect.value);
};

/* NOOD */
btnNood.onclick=()=>{
 db.ref("nood").set({actief:true,naam:current.naam,roep:current.roep});
};
closeAlert.onclick=()=>db.ref("nood").set({actief:false});

db.ref("nood").on("value",s=>{
 const d=s.val();
 if(d&&d.actief){
  alertOverlay.style.display="flex";
  alertDetail.innerText=`Noodmelding door ${d.naam} (${d.roep})`;
  alarmAudio.play().catch(()=>{});
 }else{
  alertOverlay.style.display="none";
  alarmAudio.pause();alarmAudio.currentTime=0;
 }
});

/* OVERZICHT */
db.ref("gebruikers").on("value",s=>{
 ovdList.innerHTML="";adminUserList.innerHTML="";
 Object.entries(s.val()||{}).forEach(([r,u])=>{
  ovdList.innerHTML+=`<div class="row"><div>${u.naam} (${r})</div><div class="small">${statusTxt[u.status]}</div></div>`;
  if(current?.isAdmin){
   adminUserList.innerHTML+=`<div class="row"><div>${u.naam} (${r})</div><button class="btn ghost" onclick="blockUser('${r}')">Blokkeer</button></div>`;
  }
 });
});

/* LOGIN REQUESTS */
db.ref("loginRequests").on("value",s=>{
 loginRequests.innerHTML="";
 Object.entries(s.val()||{}).forEach(([r,u])=>{
  loginRequests.innerHTML+=`<div class="row"><div>${u.naam} (${r})</div><button class="btn" onclick="approve('${r}')">Toestaan</button></div>`;
 });
});
function approve(r){db.ref("approvedUsers/"+r).set(true);db.ref("loginRequests/"+r).remove();}

/* BLOCK */
function blockUser(r){db.ref("blockedUsers/"+r).set(true);db.ref("gebruikers/"+r).remove();}
db.ref("blockedUsers").on("value",s=>{
 blockedList.innerHTML="";
 Object.keys(s.val()||{}).forEach(r=>{
  blockedList.innerHTML+=`<div class="row"><div>${r}</div><button class="btn ghost" onclick="db.ref('blockedUsers/${r}').remove()">Deblokkeer</button></div>`;
 });
});

/* VTA */
btnAddVta.onclick=()=>{
 db.ref("vtas").push({naam:vtaNaam.value,kenteken:vtaKenteken.value,info:vtaInfo.value});
};
db.ref("vtas").on("value",s=>{
 vtaTable.innerHTML="";
 Object.entries(s.val()||{}).forEach(([id,v])=>{
  vtaTable.innerHTML+=`<tr><td>${v.naam}</td><td>${v.kenteken}</td><td>${v.info}</td><td><button class="btn ghost" onclick="db.ref('vtas/${id}').remove()">X</button></td></tr>`;
 });
});
</script>

</body>
</html>
