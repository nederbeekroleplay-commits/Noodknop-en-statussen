<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8" />
<title>Noodknop & Status Systeem – VOLLEDIG WERKEND</title>
<style>
  body { font-family: Arial; background:#eef2f5; padding:20px; }
  .card { background:white; padding:20px; margin-bottom:20px; border-radius:12px; box-shadow:0 3px 6px rgba(0,0,0,0.15); }
  .btn { padding:12px 18px; margin:5px; border:none; background:#1976d2; color:white; border-radius:8px; cursor:pointer; font-size:16px; }
  .btn:hover { background:#125a9e; }
  .redBtn { background:#d32f2f !important; }
  #appContainer { display:none; }
  .statusBox { padding:10px; border-radius:8px; margin-bottom:8px; font-size:18px; }
  #alertOverlay { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(255,0,0,0.92); color:white; font-size:50px; font-weight:bold; text-align:center; padding-top:15%; z-index:99999; }
</style>
</head>
<body>

<!-- LOGIN SYSTEEM -->
<div id="loginBox" class="card">
  <h2>Inloggen</h2>
  <input id="username" placeholder="Gebruikersnaam" style="padding:10px; width:100%; font-size:16px;"><br><br>
  <input id="roepnummer" placeholder="Roepnummer" style="padding:10px; width:100%; font-size:16px;"><br><br>
  <button class="btn" onclick="login()">Inloggen</button>
</div>

<!-- APP -->
<div id="appContainer">
  <h2>Welkom: <span id="userDisplay"></span></h2>

  <div class="card">
    <h3>Noodknop</h3>
    <button class="btn redBtn" onclick="activateAlarm()">NOODKNOP</button>
  </div>

  <div class="card">
    <h3>Status wijzigen</h3>
    <select id="statusSelect" onchange="updateStatus()" style="padding:10px; font-size:16px;">
      <option value="1">Status 1 – Inzetbaar, vrij</option>
      <option value="2">Status 2 – Aanrijdend naar de melding</option>
      <option value="3">Status 3 – Ter plaatse</option>
      <option value="4">Status 4 – Bezet, max 30 minuten</option>
      <option value="5">Status 5 – Transport aanvraag</option>
      <option value="6">Status 6 – Aanvraag OC</option>
      <option value="7">Status 7 – Spoed aanvraag OC</option>
      <option value="8">Status 8 – Uitdienst</option>
    </select>
  </div>

  <div class="card">
    <h3>Dienst beheer</h3>
    <button class="btn" onclick="indienst()">In dienst</button>
    <button class="btn" onclick="uitdienst()">Uit dienst</button>
  </div>

  <div class="card">
    <h3>Overzicht ingelogde leden</h3>
    <div id="ledenOverzicht"></div>
  </div>

  <div class="card">
    <h3>Overzicht in dienst</h3>
    <div id="dienstOverzicht"></div>
  </div>
</div>

<div id="alertOverlay">NOODALARM VAN:<br><span id="alertUser"></span><br><br><button class="btn" style="background:black; font-size:28px;" onclick="closeAlert()">Sluiten</button></div>

<audio id="alarmSound">
  <source src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg" type="audio/ogg">
</audio>

<script>
let users = JSON.parse(localStorage.getItem("users") || "[]");
let inDienst = JSON.parse(localStorage.getItem("inDienst") || "[]");
let currentUser = null;

function save() {
  localStorage.setItem("users", JSON.stringify(users));
  localStorage.setItem("inDienst", JSON.stringify(inDienst));
}

function login() {
  const u = document.getElementById("username").value;
  const r = document.getElementById("roepnummer").value;

  if (!u || !r) return alert("Vul alle velden in!");

  currentUser = { user:u, roep:r, status:"8", timestamp:new Date().toLocaleString() };
  users.push(currentUser);
  save();

  document.getElementById("loginBox").style.display="none";
  document.getElementById("appContainer").style.display="block";
  document.getElementById("userDisplay").innerText = `${u} (${r})`;

  updateOverzichten();
}

function statusText(code){
  const statusMap = {
    "1":"Inzetbaar, vrij",
    "2":"Aanrijdend naar de melding",
    "3":"Ter plaatse",
    "4":"Bezet, max 30 minuten",
    "5":"Transport aanvraag",
    "6":"Aanvraag OC",
    "7":"Spoed aanvraag OC",
    "8":"Uitdienst"
  };
  return statusMap[code];
}

function statusColor(code){
  const colors = {
    "1":"#c8ffc8",
    "2":"#b3e5fc",
    "3":"#fff9c4",
    "4":"#ffe0b2",
    "5":"#f8bbd0",
    "6":"#d1c4e9",
    "7":"#ff5252",
    "8":"#e0e0e0"
  };
  return colors[code];
}

function updateStatus() {
  const s = document.getElementById("statusSelect").value;
  currentUser.status = s;
  currentUser.timestamp = new Date().toLocaleString();
  save();
  updateOverzichten();
}

function indienst() {
  if (!inDienst.find(x => x.roep === currentUser.roep)) inDienst.push(currentUser);
  currentUser.status = "1";
  save();
  updateOverzichten();
}

function uitdienst() {
  inDienst = inDienst.filter(x => x.roep !== currentUser.roep);
  currentUser.status = "8";
  save();
  updateOverzichten();
}

function updateOverzichten(){
  const leden = document.getElementById("ledenOverzicht");
  leden.innerHTML="";

  users.forEach(u => {
    const div = document.createElement("div");
    div.className="statusBox";
    div.style.background=statusColor(u.status);
    div.innerText=`${u.user} (${u.roep}) – ${statusText(u.status)}`;
    leden.appendChild(div);
  });

  const dienst = document.getElementById("dienstOverzicht");
  dienst.innerHTML="";

  inDienst.sort((a,b)=>a.status.localeCompare(b.status));

  inDienst.forEach(u => {
    const div = document.createElement("div");
    div.className="statusBox";
    div.style.background=statusColor(u.status);
    div.innerText=`${u.user} (${u.roep}) – ${statusText(u.status)} | ${u.timestamp}`;
    dienst.appendChild(div);
  });
}

function activateAlarm(){
  document.getElementById("alarmSound").play();
  document.getElementById("alertUser").innerText = `${currentUser.user} (${currentUser.roep})`;
  document.getElementById("alertOverlay").style.display="block";
}

function closeAlert(){
  document.getElementById("alertOverlay").style.display="none";
}
</script>

</body>
</html>